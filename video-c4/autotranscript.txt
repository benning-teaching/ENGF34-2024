[vidMusic]
let's start with ubuntu bug
255 161 open office can't print
sometimes
the symptom here is an intermittent
inability to print from openoffice
on openoffice's bug tracker user adrian
b
reports when i click print i get nothing
a few days later
i download the updates and open office
still prints
but a few days after that openoffice
stopped printing today
i just uploaded and can still print a
few days later i stand corrected
after a boot cycle open office failed to
print
so this is the worst kind of bug it's a
very intermittent bug and there's no
obvious pattern
a few others reported similar symptoms
but without a consistent pattern
it couldn't be reproduced so the bug
went unfixed
about nine months later user steve
writes on their bug tracker
what a fascinating bug my wife has
complained the open office will never
print on tuesdays
then she demonstrated it sure enough
won't print on tuesday
other applications print i think this is
the same bug
finally we've got a pattern openoffice
can't print on tuesdays
how is that even possible i guess we'd
better find out
how openoffice prints on other days of
the week
so what openoffice does is it generates
a postscript
file and then it sends that to the
cups print utility so postscript file
typically if you're opening a text
editor looks something like this it
basically describes
the document to be printed so what's
openoffice doing
differently and especially what's it
doing differently on tuesdays
well it's not really doing very much
differently on tuesdays it generates a
postscript file and its post refine
looks something like this
now you'll note that it includes a
creation date field
which other applications don't seem to
bother with and
key to this creation date field is
actually the day of the week is
in there tuesday is embedded in this
creation date field
so does somehow embedding this
particular character's
tuesday in the creation date field cause
it not to print
well it turns out it does if you just
for example
take that capital t and make it a
lowercase t it
actually prints so this isn't actually
an open office bug at all
it's a bug in the printing system on
ubuntu
so how does a printing system handle
files that it gets from applications
like openoffice
well the first thing it does is to use
this magic utility called file
which is a standard utility on all
unix-like systems and
it's useful for figuring out what type
of file actually is so if we run it on a
pdf file for example
it prints out that it's a pdf file and
if we run it
on let's say a postscript file generated
by firefox
it will say it's a postscript file and
if we run it on a postscript file
generated by openoffice what does it do
ah well maybe it's not too surprising
that the predict system can't actually
print that
and that's definitely not a printer file
so
here we have the bug file has an error
in
how it's interpreting the different file
types
and it's interpreting these particular
postscript files to have tui in that
particular location as being erlang
files
so how does file work well it has a
whole bunch of magic pattern matching
stuff and it just tries
hundreds and hundred of these things one
after another until they find the first
one that matches
and it turns out that there was a bug in
the particular match string for erlang
files
and it got to those before it got to
postscript files and so in this
particular case
if it had tue in that particular place
in the file
it no longer thought it was a postscript
file
ah got there at last so what lessons can
we learn from this rather curious bug
well the first thing is that
intermittent bugs are just really hard
to fix
and in general you can't fix a bug if
you can't reproduce it
so how do you go about finding out how
to reproduce it
well the first thing is to gather data
and look for patterns in the data
once you actually start to find a
pattern then
it may be possible to have enough of a
clue as to what's going on to actually
reproduce the symptoms
if you can actually reproduce it then
maybe you can understand it
and finally you can fix it and
in the end sometimes even
weird user reports are actually accurate
but not always
[Music]
we're having a problem sending email out
of the department
huh what's the problem we can't send
email more than 500 miles
come again we can't send mail further
than 500 miles from here
a little bit more actually call it 520
miles
but no further um email
really doesn't work that way generally
what makes you think you can't send mail
more than 500 miles that's what i think
you see when we first noticed this
happening a few days ago we waited a few
days
and you couldn't send email this whole
time we could send mel
just not more than 500 miles yes i got
that but
why didn't you call earlier well we
hadn't collected enough data to be sure
of what was going on until just now
anyway i asked one of the
geostatisticians to look into the
statisticians
yes and she's produced a map showing the
radius with which we can send email to
be slightly more than 500 miles
the number of destinations within that
radius that we can't reach either
or reach sporadically but we can never
send email further than this radius
i see when did this start
a few days ago you said but did anything
change in your systems at that time
well the consultant came in and patched
our server and rebooted it
but i called him he said he didn't touch
the mail system
okay um let me take a look i'll call you
back
so what do you do when you're faced with
an impossible problem like this i mean
it's just not possible to have an email
restriction of 500 miles it's
not how email works it's the first thing
to do is check the calendar and make
sure it's not april fool's day
but after that you probably want to
verify that actually
what you've been told is correct so okay
how far can we send email starting from
raleigh
well we can reach atlanta richmond
washington and new york
no problem with that but testing email
to memphis detroit
providence and boston all of them
actually really do
fail so it's real
i guess the next question is is it the
destination that's 500 miles
or the mail server if it's the
destination then it's
really hard to explain um okay so let's
relay via a mail server in seattle back
to somewhere local
and indeed that fails okay at least
that's working because
if it was the destination that would be
very hard to explain but at least the
mail server is make
some sort of sense i guess
what next okay so
we know the contractor was on here
upgrading the system
so the most likely story is that he's
messed with the configuration file
somehow
so let's have a look at that now 7ml
configuration files can be pretty opaque
at the best of times
but there's no option in here to limit
the distance you can send mail
there's some lots of interesting
configuration stuff which
only makes sense to certain people um
but in this case the senmail
configuration file had
not changed for months it was exactly
the same version that had been there
since long before this problem emerged
so
it's not that that's the problem so what
else could it be
at this point you need a bit of luck i
mean you're all out of ideas but you've
still got to gather more information
eventually something will give you a
clue
let's just tell it to the mail server
and
see whether we see anything strange
no that's the usual send mail hang on a
second what about
the version number
and suddenly the penny drops
when the technician so-called patched
the mail server what he actually did was
to
upgrade it to a later version of sonos
but in doing so he managed to downgrade
the mail server to an earlier version
than the one that we had installed on
the system
and so what happened was that the
earlier version of semail didn't read
the newer configuration file correctly
and a whole bunch of the options were
defaulting to zero
including the connection timeout value
so the connections will timeout after
zero seconds
in reality they don't time out after
zero seconds because
they time out at the minimum of one
clock tick which is 10 milliseconds
so how far can you get in 10
milliseconds well
light travels faster in a vacuum than it
does in glass so
it's about equivalent to about six
milliseconds in
a vacuum and it's got to go there and
back so
we'll reach a raxiom radius of about
three milliseconds so what's three
millilight seconds
in miles
ah well there we have it
back in 2013 german architect david
kreisel
discovered that when he was copying
construction plans
the xerox copy i was using would alter
the dimensions of the rooms
this sounds like it must be impossible
as well but let's have a look
these are the sort of architect diagrams
that he was using and
we've highlighted in yellow here the
room dimensions
so when he's copying these plans what
he's finding is that the copier actually
changes the numbers
in the rooms here are some examples
these are examples of the original and
four different types of copier copying
these produce four different sets of
results
so for example this one
in the original the dimension is 14.13
square meters
and in the copy it's 17.42
and it's not just like a corrupted image
it actually has really changed the
numbers
here's another one that's 14.13 when it
should have been 21.11
and another one also 14.13 and some more
14.13s
all those 141.13s look awfully
suspiciously like the one in the top
left there
so what's going on here
here's some more examples different
numbers that have been changed not just
architects diagrams but
other columns of numbers so if you're
using these copiers to
copy contracts that have numbers in them
you might be a bit worried by this
so this seems like a really weird bug
how can you possibly do this
so first of all we have to figure out
what actually happens with the xerox
copiers what are they doing
it turns out that they implement a
compression scheme called jbig2
and this is a perfectly reasonable
compression scheme to use
but it has two modes it has the pattern
matching and search mode
and the soft pattern matching mode and
the one that xerox used was this pattern
matching and search mode on the left
now you don't have to read these block
diagrams in a great deal of detail
to understand that they only really
differ a little bit in the middle
so what do they do well they search
around the image to try and find
a good patch of texture
or image that looks just like the bit
they're trying to compress right now
because the idea is we're trying to save
space when you
compress these images and so you search
around you find a different patch or
somewhere else in the image that
resembles the bit you're trying to code
right now
and you use that as the basis for
copying the current block of image
now pattern matching and search mode
will search around if it finds a good
enough match it will simply reuse that
block of the image
for the new block of image whereas the
soft pattern matching mode when it finds
a matching block
it will reuse it but then it will also
code the differences of that block
and so one of these is somewhat better
than the other if you're trying to
actually copy things
accurately but of course xerox used
pattern matching and search
and so when the copier searches around
the image to try and find the current
block of the image it's trying to
compress
it finds one somewhere else it's a good
enough match it doesn't matter if the
number's just a little bit different and
it reuses those numbers
reduces that part of the image so that's
what's going on
they used a compression scheme for the
ima for the image that
really probably wasn't the correct
compression scheme they should have used
so there are some lessons here
first of all the xerox implementation of
pattern matching and search was
actually correct there were no software
bugs whatsoever and
it just did what it was supposed to do
but a whole system can have bugs
even if the software doesn't there was
nothing wrong with the implementation of
patent matching research here
but obviously these copiers are buggy
because they rewrite numbers
so a really crucial thing when you're
reusing software or reusing designs
is to understand the limitations of
designs if you didn't understand the
limitations of the pattern matching the
search algorithm
and he used it in a place where it
should not be used
then you get strange bugs like this one
that's all for this video see you next
[Music]
time